<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
        <link rel="stylesheet" href="css/select2.min.css">
        <link rel="stylesheet" href="https://tfldwcss.pages.dev/tfl/tfl.min.css">
        <link rel="stylesheet" href="css/styles.css">
        <script src="/dist/tfl.min.js" type="text/javascript"></script>
        <script type="module" src="/js/element.js"></script>
        <script src="js/customs.js"></script>
        <script src="js/event.js"></script>

        <title>Đăng nhập tài khoản</title>
    </head>
    <body class="ff{Google_Sans} fns1rem fw400">
        <div x-app>
            <div id="loading-page" class="{{()=>loadingDisplay.val}}">
                <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
            </div>
        </div>
        <div class="dF fxdC ofl{hidden} mih100vh jcC">
            <div class="mw55rem mxA">
                <div class="dF mih36rem bd{1px_solid} bdc{#707070}  bda0.8125rem mb1rem">
                    <div class="p{1rem} md:p{2rem}">
                        <div class="mb2rem">
                            <a href="#" class="mw7.5rem mh4.25rem dB">
                                <img class="wF" src="./image/logo-icon.png" alt="">
                            </a>
                        </div>
                        <div class="fns28px c{#265B41} mb2rem lh2.5rem">Đăng nhập tài khoản</div>
                        <div class="mb3.25rem">
                            <div class="">
                                <div class="dF fxw mr{calc(1rem*-0.5)} ml{calc(1rem*-0.5)} gap--fm mw100%_div pr{calc(1rem*0.5)}_div pl{calc(1rem*0.5)}_div mb--fm">
                                    <div class="w4.625rem fx{0_0_auto}">
                                        <select name="" id="area_code" data-plugin="select2" data-options='{"allowClear":false, "selectionCssClass":":all:", "width":"4.625rem"}' class="mih2.5rem bd{1px_solid_#E8E9EC} bda0.25rem c{#141735} dB w100% oli{none} sbw{thin}">
                                            <option data-countryCode="VN" value="84" selected>+84</option>
                                            <option data-countryCode="DZ" value="213">+213</option>
                                            <option data-countryCode="AD" value="376">+376</option>
                                            <option data-countryCode="AO" value="244">+244</option>
                                            <option data-countryCode="AI" value="1264">+1264</option>
                                            <option data-countryCode="AG" value="1268">+1268</option>
                                            <option data-countryCode="AR" value="54">+54</option>
                                            <option data-countryCode="AM" value="374">+374</option>
                                            <option data-countryCode="AW" value="297">+297</option>
                                            <option data-countryCode="AU" value="61">+61</option>
                                            <option data-countryCode="AT" value="43">+43</option>
                                            <option data-countryCode="AZ" value="994">+994</option>
                                            <option data-countryCode="BS" value="1242">+1242</option>
                                            <option data-countryCode="BH" value="973">+973</option>
                                            <option data-countryCode="BD" value="880">+880</option>
                                            <option data-countryCode="BB" value="1246">+1246</option>
                                            <option data-countryCode="BY" value="375">+375</option>
                                            <option data-countryCode="BE" value="32">+32</option>
                                            <option data-countryCode="BZ" value="501">+501</option>
                                            <option data-countryCode="BJ" value="229">+229</option>
                                            <option data-countryCode="BM" value="1441">+1441</option>
                                            <option data-countryCode="BT" value="975">+975</option>
                                            <option data-countryCode="BO" value="591">+591</option>
                                            <option data-countryCode="BA" value="387">+387</option>
                                            <option data-countryCode="BW" value="267">+267</option>
                                            <option data-countryCode="BR" value="55">+55</option>
                                            <option data-countryCode="BN" value="673">+673</option>
                                            <option data-countryCode="BG" value="359">+359</option>
                                            <option data-countryCode="BF" value="226">+226</option>
                                            <option data-countryCode="BI" value="257">+257</option>
                                            <option data-countryCode="KH" value="855">+855</option>
                                            <option data-countryCode="CM" value="237">+237</option>
                                            <option data-countryCode="CA" value="1">+1</option>
                                            <option data-countryCode="CV" value="238">+238</option>
                                            <option data-countryCode="KY" value="1345">+1345</option>
                                            <option data-countryCode="CF" value="236">+236</option>
                                            <option data-countryCode="CL" value="56">+56</option>
                                            <option data-countryCode="CN" value="86">+86</option>
                                            <option data-countryCode="CO" value="57">+57</option>
                                            <option data-countryCode="KM" value="269">+269</option>
                                            <option data-countryCode="CG" value="242">+242</option>
                                            <option data-countryCode="CK" value="682">+682</option>
                                            <option data-countryCode="CR" value="506">+506</option>
                                            <option data-countryCode="HR" value="385">+385</option>
                                            <option data-countryCode="CU" value="53">+53</option>
                                            <option data-countryCode="CY" value="90392">+90392</option>
                                            <option data-countryCode="CY" value="357">+357</option>
                                            <option data-countryCode="CZ" value="42">+42</option>
                                            <option data-countryCode="DK" value="45">+45</option>
                                            <option data-countryCode="DJ" value="253">+253</option>
                                            <option data-countryCode="DM" value="1809">+1809</option>
                                            <option data-countryCode="DO" value="1809">+1809</option>
                                            <option data-countryCode="EC" value="593">+593</option>
                                            <option data-countryCode="EG" value="20">+20</option>
                                            <option data-countryCode="SV" value="503">+503</option>
                                            <option data-countryCode="GQ" value="240">+240</option>
                                            <option data-countryCode="ER" value="291">+291</option>
                                            <option data-countryCode="EE" value="372">+372</option>
                                            <option data-countryCode="ET" value="251">+251</option>
                                            <option data-countryCode="FK" value="500">+500</option>
                                            <option data-countryCode="FO" value="298">+298</option>
                                            <option data-countryCode="FJ" value="679">+679</option>
                                            <option data-countryCode="FI" value="358">+358</option>
                                            <option data-countryCode="FR" value="33">+33</option>
                                            <option data-countryCode="GF" value="594">+594</option>
                                            <option data-countryCode="PF" value="689">+689</option>
                                            <option data-countryCode="GA" value="241">+241</option>
                                            <option data-countryCode="GM" value="220">+220</option>
                                            <option data-countryCode="GE" value="7880">+7880</option>
                                            <option data-countryCode="DE" value="49">+49</option>
                                            <option data-countryCode="GH" value="233">+233</option>
                                            <option data-countryCode="GI" value="350">+350</option>
                                            <option data-countryCode="GR" value="30">+30</option>
                                            <option data-countryCode="GL" value="299">+299</option>
                                            <option data-countryCode="GD" value="1473">+1473</option>
                                            <option data-countryCode="GP" value="590">+590</option>
                                            <option data-countryCode="GU" value="671">+671</option>
                                            <option data-countryCode="GT" value="502">+502</option>
                                            <option data-countryCode="GN" value="224">+224</option>
                                            <option data-countryCode="GW" value="245">+245</option>
                                            <option data-countryCode="GY" value="592">+592</option>
                                            <option data-countryCode="HT" value="509">+509</option>
                                            <option data-countryCode="HN" value="504">+504</option>
                                            <option data-countryCode="HK" value="852">+852</option>
                                            <option data-countryCode="HU" value="36">+36</option>
                                            <option data-countryCode="IS" value="354">+354</option>
                                            <option data-countryCode="IN" value="91">+91</option>
                                            <option data-countryCode="ID" value="62">+62</option>
                                            <option data-countryCode="IR" value="98">+98</option>
                                            <option data-countryCode="IQ" value="964">+964</option>
                                            <option data-countryCode="IE" value="353">+353</option>
                                            <option data-countryCode="IL" value="972">+972</option>
                                            <option data-countryCode="IT" value="39">+39</option>
                                            <option data-countryCode="JM" value="1876">+1876</option>
                                            <option data-countryCode="JP" value="81">+81</option>
                                            <option data-countryCode="JO" value="962">+962</option>
                                            <option data-countryCode="KZ" value="7">+7</option>
                                            <option data-countryCode="KE" value="254">+254</option>
                                            <option data-countryCode="KI" value="686">+686</option>
                                            <option data-countryCode="KP" value="850">+850</option>
                                            <option data-countryCode="KR" value="82">+82</option>
                                            <option data-countryCode="KW" value="965">+965</option>
                                            <option data-countryCode="KG" value="996">+996</option>
                                            <option data-countryCode="LA" value="856">+856</option>
                                            <option data-countryCode="LV" value="371">+371</option>
                                            <option data-countryCode="LB" value="961">+961</option>
                                            <option data-countryCode="LS" value="266">+266</option>
                                            <option data-countryCode="LR" value="231">+231</option>
                                            <option data-countryCode="LY" value="218">+218</option>
                                            <option data-countryCode="LI" value="417">+417</option>
                                            <option data-countryCode="LT" value="370">+370</option>
                                            <option data-countryCode="LU" value="352">+352</option>
                                            <option data-countryCode="MO" value="853">+853</option>
                                            <option data-countryCode="MK" value="389">+389</option>
                                            <option data-countryCode="MG" value="261">+261</option>
                                            <option data-countryCode="MW" value="265">+265</option>
                                            <option data-countryCode="MY" value="60">+60</option>
                                            <option data-countryCode="MV" value="960">+960</option>
                                            <option data-countryCode="ML" value="223">+223</option>
                                            <option data-countryCode="MT" value="356">+356</option>
                                            <option data-countryCode="MH" value="692">+692</option>
                                            <option data-countryCode="MQ" value="596">+596</option>
                                            <option data-countryCode="MR" value="222">+222</option>
                                            <option data-countryCode="YT" value="269">+269</option>
                                            <option data-countryCode="MX" value="52">+52</option>
                                            <option data-countryCode="FM" value="691">+691</option>
                                            <option data-countryCode="MD" value="373">+373</option>
                                            <option data-countryCode="MC" value="377">+377</option>
                                            <option data-countryCode="MN" value="976">+976</option>
                                            <option data-countryCode="MS" value="1664">+1664</option>
                                            <option data-countryCode="MA" value="212">+212</option>
                                            <option data-countryCode="MZ" value="258">+258</option>
                                            <option data-countryCode="MN" value="95">+95</option>
                                            <option data-countryCode="NA" value="264">+264</option>
                                            <option data-countryCode="NR" value="674">+674</option>
                                            <option data-countryCode="NP" value="977">+977</option>
                                            <option data-countryCode="NL" value="31">+31</option>
                                            <option data-countryCode="NC" value="687">+687</option>
                                            <option data-countryCode="NZ" value="64">+64</option>
                                            <option data-countryCode="NI" value="505">+505</option>
                                            <option data-countryCode="NE" value="227">+227</option>
                                            <option data-countryCode="NG" value="234">+234</option>
                                            <option data-countryCode="NU" value="683">+683</option>
                                            <option data-countryCode="NF" value="672">+672</option>
                                            <option data-countryCode="NP" value="670">+670</option>
                                            <option data-countryCode="NO" value="47">+47</option>
                                            <option data-countryCode="OM" value="968">+968</option>
                                            <option data-countryCode="PW" value="680">+680</option>
                                            <option data-countryCode="PA" value="507">+507</option>
                                            <option data-countryCode="PG" value="675">+675</option>
                                            <option data-countryCode="PY" value="595">+595</option>
                                            <option data-countryCode="PE" value="51">+51</option>
                                            <option data-countryCode="PH" value="63">+63</option>
                                            <option data-countryCode="PL" value="48">+48</option>
                                            <option data-countryCode="PT" value="351">+351</option>
                                            <option data-countryCode="PR" value="1787">+1787</option>
                                            <option data-countryCode="QA" value="974">+974</option>
                                            <option data-countryCode="RE" value="262">+262</option>
                                            <option data-countryCode="RO" value="40">+40</option>
                                            <option data-countryCode="RU" value="7">+7</option>
                                            <option data-countryCode="RW" value="250">+250</option>
                                            <option data-countryCode="SM" value="378">+378</option>
                                            <option data-countryCode="ST" value="239">+239</option>
                                            <option data-countryCode="SA" value="966">+966</option>
                                            <option data-countryCode="SN" value="221">+221</option>
                                            <option data-countryCode="CS" value="381">+381</option>
                                            <option data-countryCode="SC" value="248">+248</option>
                                            <option data-countryCode="SL" value="232">+232</option>
                                            <option data-countryCode="SG" value="65">+65</option>
                                            <option data-countryCode="SK" value="421">+421</option>
                                            <option data-countryCode="SI" value="386">+386</option>
                                            <option data-countryCode="SB" value="677">+677</option>
                                            <option data-countryCode="SO" value="252">+252</option>
                                            <option data-countryCode="ZA" value="27">+27</option>
                                            <option data-countryCode="ES" value="34">+34</option>
                                            <option data-countryCode="LK" value="94">+94</option>
                                            <option data-countryCode="SH" value="290">+290</option>
                                            <option data-countryCode="KN" value="1869">+1869</option>
                                            <option data-countryCode="SC" value="1758">+1758</option>
                                            <option data-countryCode="SD" value="249">+249</option>
                                            <option data-countryCode="SR" value="597">+597</option>
                                            <option data-countryCode="SZ" value="268">+268</option>
                                            <option data-countryCode="SE" value="46">+46</option>
                                            <option data-countryCode="CH" value="41">+41</option>
                                            <option data-countryCode="SI" value="963">+963</option>
                                            <option data-countryCode="TW" value="886">+886</option>
                                            <option data-countryCode="TJ" value="7">+7</option>
                                            <option data-countryCode="TH" value="66">+66</option>
                                            <option data-countryCode="TG" value="228">+228</option>
                                            <option data-countryCode="TO" value="676">+676</option>
                                            <option data-countryCode="TT" value="1868">+1868</option>
                                            <option data-countryCode="TN" value="216">+216</option>
                                            <option data-countryCode="TR" value="90">+90</option>
                                            <option data-countryCode="TM" value="7">+7</option>
                                            <option data-countryCode="TM" value="993">+993</option>
                                            <option data-countryCode="TC" value="1649">+1649</option>
                                            <option data-countryCode="TV" value="688">+688</option>
                                            <option data-countryCode="UG" value="256">+256</option>
                                            <option data-countryCode="GB" value="44">+44</option>
                                            <option data-countryCode="UA" value="380">+380</option>
                                            <option data-countryCode="AE" value="971">+971</option>
                                            <option data-countryCode="UY" value="598">+598</option>
                                            <option data-countryCode="US" value="1">+1</option>
                                            <option data-countryCode="UZ" value="7">+7</option>
                                            <option data-countryCode="VU" value="678">+678</option>
                                            <option data-countryCode="VA" value="379">+379</option>
                                            <option data-countryCode="VE" value="58">+58</option>
                                            <option data-countryCode="VG" value="1284">+1284</option>
                                            <option data-countryCode="VI" value="1340">+1340</option>
                                            <option data-countryCode="WF" value="681">+681</option>
                                            <option data-countryCode="YE" value="969">+969</option>
                                            <option data-countryCode="YE" value="967">+967</option>
                                            <option data-countryCode="ZM" value="260">+260</option>
                                            <option data-countryCode="ZW" value="263">+263</option>
                                        </select>
                                    </div>
                                    <div class="fx{1_0_0%}">
                                        <input class="mih2.5rem bd{1px_solid} bdc{#E8E9EC} bda0.25rem c{#141735} dB w100% p{.45rem_1rem}" id="phone_number" type="text" placeholder="Số điện thoại" autocomplete="off" oninput="checkPhoneNumber(event)">
                                    </div>
                                </div>
                                <div class="fns--fs c{#FF6565} ml--gs dN" id="phone_number_error">Vui lòng nhập số điện thoại</div>
                            </div>
                            <div class="mb1rem posR pt--gs">
                                <input class="mih2.5rem bd{1px_solid} bdc{#E8E9EC} bda0.25rem c{#141735} dB p{.45rem_1rem} w{26.75rem} xs:w100% pr3rem" id="password" type="password" placeholder="Mật khẩu" autocomplete="off" oninput="checkPasswordLogin(event)">
                                <span class="material-symbols-outlined posA t--fm r1.18rem opc0.1 cr" onclick="toggleShowPassword('password')">visibility</span>
                                <div class="mt0.5rem fns--fs c{#FF6565} ml--gs dN" id="password_error">Vui lòng nhập mật khẩu</div>
                            </div>
                        </div>
                        <div>
                            <div class="mb2rem dF jcC">
                                <a class="c{#3B86FF} fnsty{italic} fns13px cr" onclick="forgotPassword()">Quên mật khẩu</a>
                            </div>
                            <div class="dF aiC mb2rem jcSp" >
                                <div x-app>
                                    <a href="{{()=>linkLogin.val + '/dang-ky.html'}}" class="fns--fl c{#265B41} fw700">Tạo tài khoản</a>
                                </div>
                                <t-button onclick="login()">Đăng nhập</t-button>
                            </div>
                            <div class="dF jcC" x-app>
                                <a href="{{()=>linkLogin.val + '/dang-nhap-app.html'}}" class="c{#3B86FF} fnsty{italic} fns15px cr">Đăng nhập bằng ứng dụng điện thoại</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div x-app>
                    <div x-include="./layout/login-footer.html"></div>
                </div>
            </div>
        </div>

        <script>
            let return_url = getDataUrl('url');
            if(return_url) localStorage.setItem("return_url", return_url);
            var board1 = new $MessageBoard(
                {
                    bottom:'20px',right:'0px',backgroundColor:"#333D",fontColor:"white", 
                    boardClass: "", boardStyleOverrides: {}, 
                    messageClass: '', messageStyleOverrides: {}, 
                    closerClass: '', closerStyleOverrides: {}
                }
            );
            document.addEventListener('keyup', function (event) {
                if (event.key === 'Enter') {
                    // Xử lý code tại đây khi người dùng nhấn phím Enter
                    console.log('Enter key pressed');
                    login();
                }
            });
            function login(){
                clicked.val = true;
                let area_code = '+' + document.getElementById('area_code').value;
                let param = {
                    username: document.getElementById('phone_number').value ? area_code + document.getElementById('phone_number').value : '',
                    password: document.getElementById('password').value
                }
                let phone_number = document.getElementById('phone_number').value;
                if(phone_number.indexOf('0') == 0){
                    phone_number = phone_number.slice(1);
                }
                let errArray = [];
                if(!phone_number || phone_number.length !== 9){
                    errArray.push('Vui lòng nhập số điện thoại');
                    let message_phone = '';
                    if (!phone_number) message_phone = 'Vui lòng nhập số điện thoại!';
                    if (phone_number.length !== 9) message_phone = 'Định dạng không đúng!';
                    document.getElementById('phone_number_error').innerText = message_phone;
                    if(document.getElementById('phone_number_error').classList.contains('dN')) document.getElementById('phone_number_error').classList.remove('dN');
                    if(document.getElementById('phone_number').classList.contains('bdc{#E8E9EC}')) document.getElementById('phone_number').classList.remove('bdc{#E8E9EC}');
                    if(!document.getElementById('phone_number').classList.contains('bdc{#FF6565}')) document.getElementById('phone_number').classList.add('bdc{#FF6565}');
                }else{
                    if(!document.getElementById('phone_number_error').classList.contains('dN')) document.getElementById('phone_number_error').classList.add('dN');
                    if(!document.getElementById('phone_number').classList.contains('bdc{#E8E9EC}')) document.getElementById('phone_number').classList.add('bdc{#E8E9EC}');
                    if(document.getElementById('phone_number').classList.contains('bdc{#FF6565}')) document.getElementById('phone_number').classList.remove('bdc{#FF6565}');
                }
                if(!param.password){
                    errArray.push('Vui lòng nhập mật khẩu');
                    if(document.getElementById('password_error').classList.contains('dN')) document.getElementById('password_error').classList.remove('dN');
                    if(document.getElementById('password').classList.contains('bdc{#E8E9EC}')) document.getElementById('password').classList.remove('bdc{#E8E9EC}');
                    if(!document.getElementById('password').classList.contains('bdc{#FF6565}')) document.getElementById('password').classList.add('bdc{#FF6565}');
                }else{
                    if(!document.getElementById('password_error').classList.contains('dN')) document.getElementById('password_error').classList.add('dN');
                    if(!document.getElementById('password').classList.contains('bdc{#E8E9EC}')) document.getElementById('password').classList.add('bdc{#E8E9EC}');
                    if(document.getElementById('password').classList.contains('bdc{#FF6565}')) document.getElementById('password').classList.remove('bdc{#FF6565}');
                }
                if(errArray.length > 0){
                    return;
                }else{
                    loadingDisplay.val = 'dB';
                    console.log('loadingDisplay', loadingDisplay, area_code);
                    
                    if(area_code == '+84') param.username = area_code + '0' + phone_number;
                    console.log('login', param);
                    $http.account.login(param, (result)=>{
                        // {result: true, code: 200, data: '5799c130-4b03-4d98-ab59-2edcb2aff731'}
                        if(result.result && result.code == 200){
                            toarstMessage('Thành công', '');
                            let url = localStorage.getItem('return_url');
                            if(url){
                                url = decodeURIComponent(url);
                                console.log('returm', url);
                            }else{
                                url = 'https://dwork.demo.pitoall.com/';
                            }
                            setTimeout(() => {
                                    window.location.href = url;
                            }, 500);
                        }else{
                            if(result.code == 400){
                                Swal.fire({confirmButtonText: `Thử lại`, text: "Tài khoản hoặc mật khẩu không chính xác. Vui lòng thử lại.", icon:'warning'});
                            }else{
                                toarstError(result.message, 'Lỗi');
                            }
                        }
                        loadingDisplay.val = 'dN';
                        console.log('result', result);
                    })
                }
            }
             
            function forgotPassword(){
                let phone_number = document.getElementById('phone_number').value;
                if(phone_number.indexOf('0') == 0){
                    phone_number = phone_number.slice(1);
                }
                let errArray = [];
                if(!phone_number || phone_number.length !== 9){
                    // Nếu phone không đúng chuyển trang
                    window.location.href = linkLogin.val + '/quen-mat-khau.html';
                }else{
                    let param = {
                        area_code: '+' + document.getElementById('area_code').value,
                        phone_number: document.getElementById('phone_number').value,
                    }
                    // Nếu phone đúng gửi yêu cầu 
                    loadingDisplay.val = 'dB';
                    $http.account.forgotPasswordRequest(param, (result)=>{
                        // {result: true, code: 200, data: '5799c130-4b03-4d98-ab59-2edcb2aff731'}
                        if(result.result && result.code == 200){
                            toarstMessage('Thành công', '');
                            setTimeout(()=>{
                                window.location.href = linkLogin.val + '/xac-nhan-tai-khoan.html?data=' + (result.data && result.data.zid ? result.data.zid : '');
                            },500)
                        }else{
                            toarstError(result.message, 'Lỗi');
                        }
                        loadingDisplay.val = 'dN';
                        console.log('result', result);
                    })
                }
            }
        </script>
    </body>
</html>
